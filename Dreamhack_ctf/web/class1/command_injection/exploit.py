import requests
from bs4 import BeautifulSoup

# 세션 생성
session = requests.Session()

# 1단계: / 디렉터리로 가서 user_token과 Cookie 값을 취득
url_home = "http://dvwa.mjsec.kr:8080/"
response_home = session.get(url_home)

# 쿠키 값 추출
cookies = response_home.cookies.get_dict()

# HTML 파싱하여 user_token 값 추출
soup = BeautifulSoup(response_home.text, 'html.parser')
user_token = soup.find('input', {'name': 'user_token'})['value']

# 2단계: login.php로 POST 요청 전송
url_login = "http://dvwa.mjsec.kr:8080/login.php"
headers = {
    "Host": "dvwa.mjsec.kr:8080",
    "Cache-Control": "max-age=0",
    "Accept-Language": "ko-KR",
    "Upgrade-Insecure-Requests": "1",
    "Origin": "http://dvwa.mjsec.kr:8080",
    "Content-Type": "application/x-www-form-urlencoded",
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.6533.89 Safari/537.36",
    "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7",
    "Referer": "http://dvwa.mjsec.kr:8080/login.php",
    "Accept-Encoding": "gzip, deflate, br",
    "Connection": "keep-alive"
}

data = {
    "username": "admin",
    "password": "password",
    "Login": "Login",
    "user_token": user_token
}

# 세션을 사용하여 POST 요청 보내기
response_login = session.post(url_login, headers=headers, data=data)

# 응답 확인
print(response_login.status_code)
print(response_login.text)
